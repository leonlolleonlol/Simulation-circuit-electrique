<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>projet.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/leonlolleonlol/Simulation-circuit-electrique" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><h3>Classes</h3><ul><li><a href="Ampoule.html">Ampoule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Ampoule.html#checkConnection">checkConnection</a></li><li data-type='method' style='display: none;'><a href="Ampoule.html#getBorne">getBorne</a></li><li data-type='method' style='display: none;'><a href="Ampoule.html#getConnection">getConnection</a></li><li data-type='method' style='display: none;'><a href="Ampoule.html#getConnections">getConnections</a></li><li data-type='method' style='display: none;'><a href="Ampoule.html#getProchaineComposante">getProchaineComposante</a></li><li data-type='method' style='display: none;'><a href="Ampoule.html#getTitle">getTitle</a></li><li data-type='method' style='display: none;'><a href="Ampoule.html#getType">getType</a></li><li data-type='method' style='display: none;'><a href="Ampoule.html#inBounds">inBounds</a></li><li data-type='method' style='display: none;'><a href="Ampoule.html#rotate">rotate</a></li><li data-type='method' style='display: none;'><a href="Ampoule.html#setProchaineComposante">setProchaineComposante</a></li></ul></li><li><a href="Batterie.html">Batterie</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Batterie.html#checkConnection">checkConnection</a></li><li data-type='method' style='display: none;'><a href="Batterie.html#getBorne">getBorne</a></li><li data-type='method' style='display: none;'><a href="Batterie.html#getConnection">getConnection</a></li><li data-type='method' style='display: none;'><a href="Batterie.html#getConnections">getConnections</a></li><li data-type='method' style='display: none;'><a href="Batterie.html#getProchaineComposante">getProchaineComposante</a></li><li data-type='method' style='display: none;'><a href="Batterie.html#getTitle">getTitle</a></li><li data-type='method' style='display: none;'><a href="Batterie.html#getType">getType</a></li><li data-type='method' style='display: none;'><a href="Batterie.html#inBounds">inBounds</a></li><li data-type='method' style='display: none;'><a href="Batterie.html#rotate">rotate</a></li><li data-type='method' style='display: none;'><a href="Batterie.html#setProchaineComposante">setProchaineComposante</a></li></ul></li><li><a href="Circuit.html">Circuit</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Circuit.html#ajouterComposante">ajouterComposante</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#connectComposante">connectComposante</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#echangerComposantes">echangerComposantes</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#getCircuit">getCircuit</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#getCircuits">getCircuits</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#getType">getType</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#getTypeDeCircuit">getTypeDeCircuit</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#noeudEq">noeudEq</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#rearrangerArrayCircuit">rearrangerArrayCircuit</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#remplirCondensateursAvecCharge">remplirCondensateursAvecCharge</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#remplirResisteursAvecCourant">remplirResisteursAvecCourant</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#retirerComposante">retirerComposante</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#setSymbol">setSymbol</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#solveCourrantkirchhoff">solveCourrantkirchhoff</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#trouverEq">trouverEq</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#trouverPile">trouverPile</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#trouverTypeDeCircuit">trouverTypeDeCircuit</a></li><li data-type='method' style='display: none;'><a href="Circuit.html#update">update</a></li></ul></li><li><a href="Composant.html">Composant</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Composant.html#checkConnection">checkConnection</a></li><li data-type='method' style='display: none;'><a href="Composant.html#getBorne">getBorne</a></li><li data-type='method' style='display: none;'><a href="Composant.html#getConnection">getConnection</a></li><li data-type='method' style='display: none;'><a href="Composant.html#getConnections">getConnections</a></li><li data-type='method' style='display: none;'><a href="Composant.html#getProchaineComposante">getProchaineComposante</a></li><li data-type='method' style='display: none;'><a href="Composant.html#getTitle">getTitle</a></li><li data-type='method' style='display: none;'><a href="Composant.html#getType">getType</a></li><li data-type='method' style='display: none;'><a href="Composant.html#inBounds">inBounds</a></li><li data-type='method' style='display: none;'><a href="Composant.html#rotate">rotate</a></li><li data-type='method' style='display: none;'><a href="Composant.html#setProchaineComposante">setProchaineComposante</a></li></ul></li><li><a href="Condensateur.html">Condensateur</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Condensateur.html#checkConnection">checkConnection</a></li><li data-type='method' style='display: none;'><a href="Condensateur.html#getBorne">getBorne</a></li><li data-type='method' style='display: none;'><a href="Condensateur.html#getConnection">getConnection</a></li><li data-type='method' style='display: none;'><a href="Condensateur.html#getConnections">getConnections</a></li><li data-type='method' style='display: none;'><a href="Condensateur.html#getProchaineComposante">getProchaineComposante</a></li><li data-type='method' style='display: none;'><a href="Condensateur.html#getTitle">getTitle</a></li><li data-type='method' style='display: none;'><a href="Condensateur.html#getType">getType</a></li><li data-type='method' style='display: none;'><a href="Condensateur.html#inBounds">inBounds</a></li><li data-type='method' style='display: none;'><a href="Condensateur.html#rotate">rotate</a></li><li data-type='method' style='display: none;'><a href="Condensateur.html#setProchaineComposante">setProchaineComposante</a></li></ul></li><li><a href="Diode.html">Diode</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Diode.html#checkConnection">checkConnection</a></li><li data-type='method' style='display: none;'><a href="Diode.html#getBorne">getBorne</a></li><li data-type='method' style='display: none;'><a href="Diode.html#getConnection">getConnection</a></li><li data-type='method' style='display: none;'><a href="Diode.html#getConnections">getConnections</a></li><li data-type='method' style='display: none;'><a href="Diode.html#getProchaineComposante">getProchaineComposante</a></li><li data-type='method' style='display: none;'><a href="Diode.html#getTitle">getTitle</a></li><li data-type='method' style='display: none;'><a href="Diode.html#getType">getType</a></li><li data-type='method' style='display: none;'><a href="Diode.html#inBounds">inBounds</a></li><li data-type='method' style='display: none;'><a href="Diode.html#rotate">rotate</a></li><li data-type='method' style='display: none;'><a href="Diode.html#setProchaineComposante">setProchaineComposante</a></li></ul></li><li><a href="Fil.html">Fil</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Fil.html#angle">angle</a></li><li data-type='method' style='display: none;'><a href="Fil.html#getFunction">getFunction</a></li><li data-type='method' style='display: none;'><a href="Fil.html#getType">getType</a></li><li data-type='method' style='display: none;'><a href="Fil.html#inBounds">inBounds</a></li><li data-type='method' style='display: none;'><a href="Fil.html#inBoxBounds">inBoxBounds</a></li><li data-type='method' style='display: none;'><a href="Fil.html#intersection">intersection</a></li><li data-type='method' style='display: none;'><a href="Fil.html#longueur">longueur</a></li><li data-type='method' style='display: none;'><a href="Fil.html#overlap">overlap</a></li><li data-type='method' style='display: none;'><a href="Fil.html#pente">pente</a></li><li data-type='method' style='display: none;'><a href="Fil.html#trierPoint">trierPoint</a></li></ul></li><li><a href="Noeuds.html">Noeuds</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Noeuds.html#ajouterComposante">ajouterComposante</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#checkConnection">checkConnection</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#getBorne">getBorne</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#getConnection">getConnection</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#getConnections">getConnections</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#getProchaineComposante">getProchaineComposante</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#getTitle">getTitle</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#getType">getType</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#inBounds">inBounds</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#maille">maille</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#remplirCondensateursAvecTension">remplirCondensateursAvecTension</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#remplirResisteursAvecDifTension">remplirResisteursAvecDifTension</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#rotate">rotate</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#setProchaineComposante">setProchaineComposante</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#trouverEq">trouverEq</a></li><li data-type='method' style='display: none;'><a href="Noeuds.html#trouverTypeDeCircuit">trouverTypeDeCircuit</a></li></ul></li><li><a href="Resisteur.html">Resisteur</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Resisteur.html#checkConnection">checkConnection</a></li><li data-type='method' style='display: none;'><a href="Resisteur.html#getBorne">getBorne</a></li><li data-type='method' style='display: none;'><a href="Resisteur.html#getConnection">getConnection</a></li><li data-type='method' style='display: none;'><a href="Resisteur.html#getConnections">getConnections</a></li><li data-type='method' style='display: none;'><a href="Resisteur.html#getProchaineComposante">getProchaineComposante</a></li><li data-type='method' style='display: none;'><a href="Resisteur.html#getTitle">getTitle</a></li><li data-type='method' style='display: none;'><a href="Resisteur.html#getType">getType</a></li><li data-type='method' style='display: none;'><a href="Resisteur.html#inBounds">inBounds</a></li><li data-type='method' style='display: none;'><a href="Resisteur.html#rotate">rotate</a></li><li data-type='method' style='display: none;'><a href="Resisteur.html#setProchaineComposante">setProchaineComposante</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#AMPOULE">AMPOULE</a></li><li><a href="global.html#BAS">BAS</a></li><li><a href="global.html#BATTERIE">BATTERIE</a></li><li><a href="global.html#CIRCUIT">CIRCUIT</a></li><li><a href="global.html#CONDENSATEUR">CONDENSATEUR</a></li><li><a href="global.html#CREATE">CREATE</a></li><li><a href="global.html#DIODE">DIODE</a></li><li><a href="global.html#DROITE">DROITE</a></li><li><a href="global.html#FIL">FIL</a></li><li><a href="global.html#FunctionObject">FunctionObject</a></li><li><a href="global.html#GAUCHE">GAUCHE</a></li><li><a href="global.html#HAUT">HAUT</a></li><li><a href="global.html#MODIFIER">MODIFIER</a></li><li><a href="global.html#NOEUD">NOEUD</a></li><li><a href="global.html#POINT">POINT</a></li><li><a href="global.html#QUADRILLE">QUADRILLE</a></li><li><a href="global.html#QUADRILLEPOINT">QUADRILLEPOINT</a></li><li><a href="global.html#RESISTEUR">RESISTEUR</a></li><li><a href="global.html#SUPPRIMER">SUPPRIMER</a></li><li><a href="global.html#addActions">addActions</a></li><li><a href="global.html#ajustementAutomatiqueComposant">ajustementAutomatiqueComposant</a></li><li><a href="global.html#ajustementAutomatiqueFil">ajustementAutomatiqueFil</a></li><li><a href="global.html#ampoule">ampoule</a></li><li><a href="global.html#appliquerTransformation">appliquerTransformation</a></li><li><a href="global.html#applyLimitActions">applyLimitActions</a></li><li><a href="global.html#batterie">batterie</a></li><li><a href="global.html#blendBG">blendBG</a></li><li><a href="global.html#circuitMaille">circuitMaille</a></li><li><a href="global.html#condensateur">condensateur</a></li><li><a href="global.html#copyComposant">copyComposant</a></li><li><a href="global.html#couperFil">couperFil</a></li><li><a href="global.html#createColorGradient">createColorGradient</a></li><li><a href="global.html#diode">diode</a></li><li><a href="global.html#draw">draw</a></li><li><a href="global.html#drawComponentsChooser">drawComponentsChooser</a></li><li><a href="global.html#drawFils">drawFils</a></li><li><a href="global.html#drawGrid">drawGrid</a></li><li><a href="global.html#drawNoeuds">drawNoeuds</a></li><li><a href="global.html#filStart">filStart</a></li><li><a href="global.html#findGridLock">findGridLock</a></li><li><a href="global.html#getAllConnection">getAllConnection</a></li><li><a href="global.html#getConnectingComposant">getConnectingComposant</a></li><li><a href="global.html#getPossibleConnections">getPossibleConnections</a></li><li><a href="global.html#getStringData">getStringData</a></li><li><a href="global.html#inGrid">inGrid</a></li><li><a href="global.html#initDrag">initDrag</a></li><li><a href="global.html#isElementDrag">isElementDrag</a></li><li><a href="global.html#isElementSelectionner">isElementSelectionner</a></li><li><a href="global.html#lineGrid">lineGrid</a></li><li><a href="global.html#load">load</a></li><li><a href="global.html#loadLocalCircuit">loadLocalCircuit</a></li><li><a href="global.html#mouseDragged">mouseDragged</a></li><li><a href="global.html#mousePressed">mousePressed</a></li><li><a href="global.html#mouseReleased">mouseReleased</a></li><li><a href="global.html#mouseWheel">mouseWheel</a></li><li><a href="global.html#pointGrid">pointGrid</a></li><li><a href="global.html#posAtPercent">posAtPercent</a></li><li><a href="global.html#redo">redo</a></li><li><a href="global.html#resetHistorique">resetHistorique</a></li><li><a href="global.html#resisteur">resisteur</a></li><li><a href="global.html#sauvegarder">sauvegarder</a></li><li><a href="global.html#selectionBox">selectionBox</a></li><li><a href="global.html#setModificationFilPos">setModificationFilPos</a></li><li><a href="global.html#setTooltip">setTooltip</a></li><li><a href="global.html#splitFil">splitFil</a></li><li><a href="global.html#telecharger">telecharger</a></li><li><a href="global.html#undo">undo</a></li><li><a href="global.html#updateBouton">updateBouton</a></li><li><a href="global.html#updateFilPos">updateFilPos</a></li><li><a href="global.html#updateNoeud">updateNoeud</a></li><li><a href="global.html#upload">upload</a></li><li><a href="global.html#validBoutonActif">validBoutonActif</a></li><li><a href="global.html#validComposantPos">validComposantPos</a></li><li><a href="global.html#validFilBegin">validFilBegin</a></li><li><a href="global.html#validerAction">validerAction</a></li><li><a href="global.html#verifierCouperFil">verifierCouperFil</a></li><li><a href="global.html#verifierCouperNoeud">verifierCouperNoeud</a></li><li><a href="global.html#verifierSplitNewComposant">verifierSplitNewComposant</a></li><li><a href="global.html#windowResized">windowResized</a></li><li><a href="global.html#zoom">zoom</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">projet.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
const components = [];// Liste de composants du circuit
const fils = [];// Liste des fils du circuit
let name;
let id;


function initProjet(){
  let projet = select('#circuit');
  if(projet!=null){
    load(JSON.parse(projet.elt.innerText));
  }else{
    loadLocalCircuit();
    id = Date.now();
  }
}

/**
 * Cette fonction permet de load un circuit à partir de donnée Json. Cette fonction est très
 * importante puisque certaine donné doivent être résolue (transformé en bon format) comme 
 * le type de l'objet (prototype) qui est très important pour les méthodes et 
 * les id (voir commentaire dans fonction sauvegarder)
 * @param {object} data Un objet représentant nos données
 */
function load(data) {
  id = data.id ?? Date.now();
  name = data.name ?? ('Circuit inconnus ' + id);
  let tempElements = data.components.concat(data.fils);
  components.length = fils.length = 0;
  let map = new Map();

  // Réaffecter les méthodes de classe
  tempElements.map((element) => {
    let objetVide = element.type == FIL ? new Fil() : new Composant(element.type);
    let object = Object.assign(objetVide, element);//ajouter information à l'objet vide
    if (object instanceof Composant) {
      components.push(object);
    }
    else if (object instanceof Fil) {
      fils.push(object)
    }
    map.set(object.id, object);
    return object;
  })

  // Remplacer les id par des objets
  for (const element of tempElements) {
    for (const key in element) {
      if (Object.hasOwnProperty.call(element, key)) {
        const value = element[key];
        if (typeof value == 'object' &amp;&amp; value != null &amp;&amp; value.id != null) {
          element[key] = map.get(value.id);
        }
      }
    }
  }
}

/**
 * Transforme notre circuit en string json. Aussi, remplace les occurences 
 * d'objet répétitive par leurs identifiants
 * @returns {string}
 */
function getStringData() {
  let informations = { id, name, components, fils };
  let caches = [];// permet d'enregistrer un objet une fois et d'utiliser des numéros d'identification les autres fois
  return JSON.stringify(informations, function (key, value) {
    if (value instanceof Composant || value instanceof Fil) {
      if (!caches.includes(value)) {
        caches.push(value);
        return value;
      } else return { id: value.id }
    }
    return value;
  });
}


/**
 * Fonction qui permet d'envoyer une requête au serveur pour enregistrer le circuit.
 * La fonction va automatiquement produire une alerte si une erreur dans quelconque est produite
 */
async function sauvegarder() {
  let data = getStringData();
  // envoi de la requête
  await fetch('/query', {
    method: "POST",
    cache: "no-cache",
    headers: {
      "Content-Type": "application/json",
    },
    referrerPolicy: "no-referrer",
    body: data,
  }).then(function (response) {
    //les actions à faire lorsque notre action réussis
    console.log('JSON data saved successfully');
  }).catch(function () {
    alert('Votre sauvegarde a échouer');
  });
}

/**
 * Fait une requête au serveur pour récupérer un des circuits test qui est 
 * enregistrer dans sur le serveur (pas dans la base de donné) et load le circuit
 * @param {string} Le nom du fichier json contenant le circuit demander. Par défaut le circuit de base
 * @see baseCircuit Le nom du circuit à récupérer
 */
async function loadLocalCircuit(circuit = baseCircuit) {
  fetch('test/circuit/' + circuit)
    .then((response) => response.json())
    .then((json) => load(json));
}

/**
 * @see https://www.aspsnippets.com/Articles/Download-JSON-object-Array-as-File-from-Browser-using-JavaScript.aspx
 */
function telecharger() {
  let data = [getStringData()];
  const blob = new Blob(data, { type: "application/json" });
  let isIE = false || !!document.documentMode;
  if (isIE) {
    window.navigator.msSaveBlob(blob, "circuit.json");
  } else {
    let url = window.URL || window.webkitURL;
    let link = url.createObjectURL(blob);
    let a = document.createElement("a");
    if (name != 'Circuit inconnus')
      a.download = name + ".json";
    else a.download = "circuit.json";
    a.href = link;
    a.click();
  }
}

/**
 * 
 */
function upload() {
  let input = document.createElement("input");
  input.type = "file";
  input.addEventListener("change", function () {
    if (this.files[0] != null) {
      let file = this.files[0];
      const reader = new FileReader();
      reader.onload = (evt) => {
        load(JSON.parse(reader.result));
      };
      reader.readAsText(file);
    }
  }, false);
  input.click();
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Mon May 22 2023 21:44:06 GMT-0400 (Eastern Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
